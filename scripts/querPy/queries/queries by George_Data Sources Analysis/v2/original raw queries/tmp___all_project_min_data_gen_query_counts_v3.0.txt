DEFINE input:inference 'parthenos_rules'

PREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#>
PREFIX rdfs: <http://www.w3.org/2000/01/rdf-schema#>
PREFIX parthenos: <http://parthenos.d4science.org/CRMext/CRMpe.rdfs/>
PREFIX crm: <http://www.cidoc-crm.org/cidoc-crm/>
PREFIX crmdig: <http://www.ics.forth.gr/isl/CRMext/CRMdig.rdfs/>


select distinct 
#?gRecord
( COALESCE(str(?instance_label), ?instanceURI) as ?instance )  
( COALESCE(str(?ID_label), ?ID) as ?id)
( COALESCE(str(?Name_label), ?Name) as ?name )
#( COALESCE(str(?Service_label), ?Service) as ?service )
( COALESCE(str(?Team_label), ?Team) as ?team )

( COUNT(?Member)>0 as ?member )
( COUNT(?Member_address)>0 as ?member_address )
( COUNT(?Member_address_type)>0 as ?member_address_type )

( COUNT(?Time_span)>0 as ?time_span )
( COUNT(?Time_actual)>0 as ?time_actual )


where {

#source
GRAPH <provenance> {?gRecord <dnetcollectedFrom> ?api . ?api <dnetisApiOf> "PARTHENOS"^^<http://www.w3.org/2001/XMLSchema#string>.}

#Gets all Projects per source-record
GRAPH ?gRecord {#

#Gets the Project
?instanceURI a parthenos:PE35_Project .

#Gets the Label of Project
?instanceURI rdfs:label ?instance_label .

#Gets ID of Project
OPTIONAL { ?instanceURI crm:P1_is_identified_by ?ID . 
 ?ID a crm:E42_Identifier; rdfs:label ?ID_label. }

#Gets Value of Name of Project
OPTIONAL { ?instanceURI crm:P1_is_identified_by ?Name.
 ?Name a crm:E41_Appellation; rdfs:label ?Name_label. }

#Gets the Service currently offered by Project
#OPTIONAL { ?instanceURI parthenos:PP1_currently_offers ?Service .
# OPTIONAL { ?Service rdfs:label ?Service_label. }  }

#Gets the Team currently maintaining Project
OPTIONAL { ?instanceURI parthenos:PP44_has_maintaining_team ?Team .
 OPTIONAL { ?Team rdfs:label ?Team_label.}
 
 #Gets the Members of the Team
 OPTIONAL { ?Team crm:P107_has_current_or_former_member ?Member .
  OPTIONAL { ?Member rdfs:label ?Member_label. }
 
   #Gets the Address of Actor
   OPTIONAL { ?Member crm:P76_has_contact_point ?Member_address.
    OPTIONAL { ?Member_address rdfs:label ?Member_address_label. }
 
    #Gets the type of Address of Actor
    OPTIONAL { ?Member_address crm:P2_has_type ?Member_address_type.
     OPTIONAL { ?Member_address_type rdfs:label ?Member_address_type_label. } 
    }#Member_address_type --end
   }#Member_address --end
  }#Member --end
 }#Team --end
 

#Gets the Time since when project has been run
OPTIONAL { ?instanceURI crm:P4_has_time-span ?Time_span .
 OPTIONAL { ?Time_span rdfs:label ?Time_span_label. } 
 OPTIONAL { ?Time_span crm:P82a_begin_of_the_begin ?Time_actual .}
}

}#?gRecord --end

}
order by  ?instance ?id ?name ?team #?service

